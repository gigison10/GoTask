{"ast":null,"code":"\"use strict\";\n\n// Copyright 2022 Google LLC\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nvar __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _HashStreamValidator_crc32cHash, _HashStreamValidator_md5Hash, _HashStreamValidator_md5Digest;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.HashStreamValidator = void 0;\nconst crypto_1 = require(\"crypto\");\nconst stream_1 = require(\"stream\");\nconst crc32c_1 = require(\"./crc32c\");\nconst file_1 = require(\"./file\");\nclass HashStreamValidator extends stream_1.Transform {\n  constructor() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    super();\n    this.updateHashesOnly = false;\n    _HashStreamValidator_crc32cHash.set(this, undefined);\n    _HashStreamValidator_md5Hash.set(this, undefined);\n    _HashStreamValidator_md5Digest.set(this, '');\n    this.crc32cEnabled = !!options.crc32c;\n    this.md5Enabled = !!options.md5;\n    this.updateHashesOnly = !!options.updateHashesOnly;\n    this.crc32cExpected = options.crc32cExpected;\n    this.md5Expected = options.md5Expected;\n    if (this.crc32cEnabled) {\n      const crc32cGenerator = options.crc32cGenerator || crc32c_1.CRC32C_DEFAULT_VALIDATOR_GENERATOR;\n      __classPrivateFieldSet(this, _HashStreamValidator_crc32cHash, crc32cGenerator(), \"f\");\n    }\n    if (this.md5Enabled) {\n      __classPrivateFieldSet(this, _HashStreamValidator_md5Hash, (0, crypto_1.createHash)('md5'), \"f\");\n    }\n  }\n  _flush(callback) {\n    if (__classPrivateFieldGet(this, _HashStreamValidator_md5Hash, \"f\")) {\n      __classPrivateFieldSet(this, _HashStreamValidator_md5Digest, __classPrivateFieldGet(this, _HashStreamValidator_md5Hash, \"f\").digest('base64'), \"f\");\n    }\n    if (this.updateHashesOnly) {\n      callback();\n      return;\n    }\n    // If we're doing validation, assume the worst-- a data integrity\n    // mismatch. If not, these tests won't be performed, and we can assume\n    // the best.\n    // We must check if the server decompressed the data on serve because hash\n    // validation is not possible in this case.\n    let failed = this.crc32cEnabled || this.md5Enabled;\n    if (this.crc32cEnabled && this.crc32cExpected) {\n      failed = !this.test('crc32c', this.crc32cExpected);\n    }\n    if (this.md5Enabled && this.md5Expected) {\n      failed = !this.test('md5', this.md5Expected);\n    }\n    if (failed) {\n      const mismatchError = new file_1.RequestError(file_1.FileExceptionMessages.DOWNLOAD_MISMATCH);\n      mismatchError.code = 'CONTENT_DOWNLOAD_MISMATCH';\n      callback(mismatchError);\n    } else {\n      callback();\n    }\n  }\n  _transform(chunk, encoding, callback) {\n    this.push(chunk, encoding);\n    try {\n      if (__classPrivateFieldGet(this, _HashStreamValidator_crc32cHash, \"f\")) __classPrivateFieldGet(this, _HashStreamValidator_crc32cHash, \"f\").update(chunk);\n      if (__classPrivateFieldGet(this, _HashStreamValidator_md5Hash, \"f\")) __classPrivateFieldGet(this, _HashStreamValidator_md5Hash, \"f\").update(chunk);\n      callback();\n    } catch (e) {\n      callback(e);\n    }\n  }\n  test(hash, sum) {\n    const check = Buffer.isBuffer(sum) ? sum.toString('base64') : sum;\n    if (hash === 'crc32c' && __classPrivateFieldGet(this, _HashStreamValidator_crc32cHash, \"f\")) {\n      return __classPrivateFieldGet(this, _HashStreamValidator_crc32cHash, \"f\").validate(check);\n    }\n    if (hash === 'md5' && __classPrivateFieldGet(this, _HashStreamValidator_md5Hash, \"f\")) {\n      return __classPrivateFieldGet(this, _HashStreamValidator_md5Digest, \"f\") === check;\n    }\n    return false;\n  }\n}\nexports.HashStreamValidator = HashStreamValidator;\n_HashStreamValidator_crc32cHash = new WeakMap(), _HashStreamValidator_md5Hash = new WeakMap(), _HashStreamValidator_md5Digest = new WeakMap();","map":{"version":3,"names":["__classPrivateFieldSet","receiver","state","value","kind","f","TypeError","has","call","set","__classPrivateFieldGet","get","_HashStreamValidator_crc32cHash","_HashStreamValidator_md5Hash","_HashStreamValidator_md5Digest","Object","defineProperty","exports","HashStreamValidator","crypto_1","require","stream_1","crc32c_1","file_1","Transform","constructor","options","arguments","length","undefined","updateHashesOnly","crc32cEnabled","crc32c","md5Enabled","md5","crc32cExpected","md5Expected","crc32cGenerator","CRC32C_DEFAULT_VALIDATOR_GENERATOR","createHash","_flush","callback","digest","failed","test","mismatchError","RequestError","FileExceptionMessages","DOWNLOAD_MISMATCH","code","_transform","chunk","encoding","push","update","e","hash","sum","check","Buffer","isBuffer","toString","validate","WeakMap"],"sources":["D:/Coding/React/taskmybusiness/node_modules/@google-cloud/storage/build/src/hash-stream-validator.js"],"sourcesContent":["\"use strict\";\n// Copyright 2022 Google LLC\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nvar __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n};\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _HashStreamValidator_crc32cHash, _HashStreamValidator_md5Hash, _HashStreamValidator_md5Digest;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.HashStreamValidator = void 0;\nconst crypto_1 = require(\"crypto\");\nconst stream_1 = require(\"stream\");\nconst crc32c_1 = require(\"./crc32c\");\nconst file_1 = require(\"./file\");\nclass HashStreamValidator extends stream_1.Transform {\n    constructor(options = {}) {\n        super();\n        this.updateHashesOnly = false;\n        _HashStreamValidator_crc32cHash.set(this, undefined);\n        _HashStreamValidator_md5Hash.set(this, undefined);\n        _HashStreamValidator_md5Digest.set(this, '');\n        this.crc32cEnabled = !!options.crc32c;\n        this.md5Enabled = !!options.md5;\n        this.updateHashesOnly = !!options.updateHashesOnly;\n        this.crc32cExpected = options.crc32cExpected;\n        this.md5Expected = options.md5Expected;\n        if (this.crc32cEnabled) {\n            const crc32cGenerator = options.crc32cGenerator || crc32c_1.CRC32C_DEFAULT_VALIDATOR_GENERATOR;\n            __classPrivateFieldSet(this, _HashStreamValidator_crc32cHash, crc32cGenerator(), \"f\");\n        }\n        if (this.md5Enabled) {\n            __classPrivateFieldSet(this, _HashStreamValidator_md5Hash, (0, crypto_1.createHash)('md5'), \"f\");\n        }\n    }\n    _flush(callback) {\n        if (__classPrivateFieldGet(this, _HashStreamValidator_md5Hash, \"f\")) {\n            __classPrivateFieldSet(this, _HashStreamValidator_md5Digest, __classPrivateFieldGet(this, _HashStreamValidator_md5Hash, \"f\").digest('base64'), \"f\");\n        }\n        if (this.updateHashesOnly) {\n            callback();\n            return;\n        }\n        // If we're doing validation, assume the worst-- a data integrity\n        // mismatch. If not, these tests won't be performed, and we can assume\n        // the best.\n        // We must check if the server decompressed the data on serve because hash\n        // validation is not possible in this case.\n        let failed = this.crc32cEnabled || this.md5Enabled;\n        if (this.crc32cEnabled && this.crc32cExpected) {\n            failed = !this.test('crc32c', this.crc32cExpected);\n        }\n        if (this.md5Enabled && this.md5Expected) {\n            failed = !this.test('md5', this.md5Expected);\n        }\n        if (failed) {\n            const mismatchError = new file_1.RequestError(file_1.FileExceptionMessages.DOWNLOAD_MISMATCH);\n            mismatchError.code = 'CONTENT_DOWNLOAD_MISMATCH';\n            callback(mismatchError);\n        }\n        else {\n            callback();\n        }\n    }\n    _transform(chunk, encoding, callback) {\n        this.push(chunk, encoding);\n        try {\n            if (__classPrivateFieldGet(this, _HashStreamValidator_crc32cHash, \"f\"))\n                __classPrivateFieldGet(this, _HashStreamValidator_crc32cHash, \"f\").update(chunk);\n            if (__classPrivateFieldGet(this, _HashStreamValidator_md5Hash, \"f\"))\n                __classPrivateFieldGet(this, _HashStreamValidator_md5Hash, \"f\").update(chunk);\n            callback();\n        }\n        catch (e) {\n            callback(e);\n        }\n    }\n    test(hash, sum) {\n        const check = Buffer.isBuffer(sum) ? sum.toString('base64') : sum;\n        if (hash === 'crc32c' && __classPrivateFieldGet(this, _HashStreamValidator_crc32cHash, \"f\")) {\n            return __classPrivateFieldGet(this, _HashStreamValidator_crc32cHash, \"f\").validate(check);\n        }\n        if (hash === 'md5' && __classPrivateFieldGet(this, _HashStreamValidator_md5Hash, \"f\")) {\n            return __classPrivateFieldGet(this, _HashStreamValidator_md5Digest, \"f\") === check;\n        }\n        return false;\n    }\n}\nexports.HashStreamValidator = HashStreamValidator;\n_HashStreamValidator_crc32cHash = new WeakMap(), _HashStreamValidator_md5Hash = new WeakMap(), _HashStreamValidator_md5Digest = new WeakMap();\n//# sourceMappingURL=hash-stream-validator.js.map"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}