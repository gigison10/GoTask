{"ast":null,"code":"const jose = require('jose');\nconst {\n  ArgumentError\n} = require('../errors');\nconst {\n  JwksClient\n} = require('../JwksClient');\nconst supportedAlg = require('./config');\nconst handleSigningKeyError = (err, cb) => {\n  // If we didn't find a match, can't provide a key.\n  if (err && err.name === 'SigningKeyNotFoundError') {\n    return cb(null);\n  }\n\n  // If an error occured like rate limiting or HTTP issue, we'll bubble up the error.\n  if (err) {\n    return cb(err);\n  }\n};\nmodule.exports.passportJwtSecret = function (options) {\n  if (options === null || options === undefined) {\n    throw new ArgumentError('An options object must be provided when initializing passportJwtSecret');\n  }\n  if (!options.jwksUri) {\n    throw new ArgumentError('No JWKS provided. Please provide a jwksUri');\n  }\n  const client = new JwksClient(options);\n  const onError = options.handleSigningKeyError || handleSigningKeyError;\n  return function secretProvider(req, rawJwtToken, cb) {\n    let decoded;\n    try {\n      decoded = {\n        payload: jose.decodeJwt(rawJwtToken),\n        header: jose.decodeProtectedHeader(rawJwtToken)\n      };\n    } catch (err) {\n      decoded = null;\n    }\n    if (!decoded || !supportedAlg.includes(decoded.header.alg)) {\n      return cb(null, null);\n    }\n    client.getSigningKey(decoded.header.kid).then(key => {\n      cb(null, key.publicKey || key.rsaPublicKey);\n    }).catch(err => {\n      onError(err, newError => cb(newError, null));\n    });\n  };\n};","map":{"version":3,"names":["jose","require","ArgumentError","JwksClient","supportedAlg","handleSigningKeyError","err","cb","name","module","exports","passportJwtSecret","options","undefined","jwksUri","client","onError","secretProvider","req","rawJwtToken","decoded","payload","decodeJwt","header","decodeProtectedHeader","includes","alg","getSigningKey","kid","then","key","publicKey","rsaPublicKey","catch","newError"],"sources":["D:/Coding/React/taskmybusiness/node_modules/jwks-rsa/src/integrations/passport.js"],"sourcesContent":["const jose = require('jose');\nconst { ArgumentError } = require('../errors');\nconst { JwksClient } = require('../JwksClient');\nconst supportedAlg = require('./config');\n\nconst handleSigningKeyError = (err, cb) => {\n  // If we didn't find a match, can't provide a key.\n  if (err && err.name === 'SigningKeyNotFoundError') {\n    return cb(null);\n  }\n\n  // If an error occured like rate limiting or HTTP issue, we'll bubble up the error.\n  if (err) {\n    return cb(err);\n  }\n};\n\nmodule.exports.passportJwtSecret = function (options) {\n  if (options === null || options === undefined) {\n    throw new ArgumentError('An options object must be provided when initializing passportJwtSecret');\n  }\n\n  if (!options.jwksUri) {\n    throw new ArgumentError('No JWKS provided. Please provide a jwksUri');\n  }\n\n  const client = new JwksClient(options);\n  const onError = options.handleSigningKeyError || handleSigningKeyError;\n\n  return function secretProvider(req, rawJwtToken, cb) {\n    let decoded;\n    try {\n      decoded = {\n        payload: jose.decodeJwt(rawJwtToken),\n        header: jose.decodeProtectedHeader(rawJwtToken)\n      };\n    } catch (err) {\n      decoded = null;\n    }\n\n    if (!decoded || !supportedAlg.includes(decoded.header.alg)) {\n      return cb(null, null);\n    }\n\n    client.getSigningKey(decoded.header.kid)\n      .then(key => {\n        cb(null, key.publicKey || key.rsaPublicKey);\n      }).catch(err => {\n        onError(err, (newError) => cb(newError, null));\n      });\n  };\n};\n"],"mappings":"AAAA,MAAMA,IAAI,GAAGC,OAAO,CAAC,MAAM,CAAC;AAC5B,MAAM;EAAEC;AAAc,CAAC,GAAGD,OAAO,CAAC,WAAW,CAAC;AAC9C,MAAM;EAAEE;AAAW,CAAC,GAAGF,OAAO,CAAC,eAAe,CAAC;AAC/C,MAAMG,YAAY,GAAGH,OAAO,CAAC,UAAU,CAAC;AAExC,MAAMI,qBAAqB,GAAGA,CAACC,GAAG,EAAEC,EAAE,KAAK;EACzC;EACA,IAAID,GAAG,IAAIA,GAAG,CAACE,IAAI,KAAK,yBAAyB,EAAE;IACjD,OAAOD,EAAE,CAAC,IAAI,CAAC;EACjB;;EAEA;EACA,IAAID,GAAG,EAAE;IACP,OAAOC,EAAE,CAACD,GAAG,CAAC;EAChB;AACF,CAAC;AAEDG,MAAM,CAACC,OAAO,CAACC,iBAAiB,GAAG,UAAUC,OAAO,EAAE;EACpD,IAAIA,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAKC,SAAS,EAAE;IAC7C,MAAM,IAAIX,aAAa,CAAC,wEAAwE,CAAC;EACnG;EAEA,IAAI,CAACU,OAAO,CAACE,OAAO,EAAE;IACpB,MAAM,IAAIZ,aAAa,CAAC,4CAA4C,CAAC;EACvE;EAEA,MAAMa,MAAM,GAAG,IAAIZ,UAAU,CAACS,OAAO,CAAC;EACtC,MAAMI,OAAO,GAAGJ,OAAO,CAACP,qBAAqB,IAAIA,qBAAqB;EAEtE,OAAO,SAASY,cAAcA,CAACC,GAAG,EAAEC,WAAW,EAAEZ,EAAE,EAAE;IACnD,IAAIa,OAAO;IACX,IAAI;MACFA,OAAO,GAAG;QACRC,OAAO,EAAErB,IAAI,CAACsB,SAAS,CAACH,WAAW,CAAC;QACpCI,MAAM,EAAEvB,IAAI,CAACwB,qBAAqB,CAACL,WAAW;MAChD,CAAC;IACH,CAAC,CAAC,OAAOb,GAAG,EAAE;MACZc,OAAO,GAAG,IAAI;IAChB;IAEA,IAAI,CAACA,OAAO,IAAI,CAAChB,YAAY,CAACqB,QAAQ,CAACL,OAAO,CAACG,MAAM,CAACG,GAAG,CAAC,EAAE;MAC1D,OAAOnB,EAAE,CAAC,IAAI,EAAE,IAAI,CAAC;IACvB;IAEAQ,MAAM,CAACY,aAAa,CAACP,OAAO,CAACG,MAAM,CAACK,GAAG,CAAC,CACrCC,IAAI,CAACC,GAAG,IAAI;MACXvB,EAAE,CAAC,IAAI,EAAEuB,GAAG,CAACC,SAAS,IAAID,GAAG,CAACE,YAAY,CAAC;IAC7C,CAAC,CAAC,CAACC,KAAK,CAAC3B,GAAG,IAAI;MACdU,OAAO,CAACV,GAAG,EAAG4B,QAAQ,IAAK3B,EAAE,CAAC2B,QAAQ,EAAE,IAAI,CAAC,CAAC;IAChD,CAAC,CAAC;EACN,CAAC;AACH,CAAC"},"metadata":{},"sourceType":"script","externalDependencies":[]}