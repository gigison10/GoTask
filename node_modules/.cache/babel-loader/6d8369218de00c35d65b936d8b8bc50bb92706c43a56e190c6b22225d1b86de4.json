{"ast":null,"code":"const logger = require('debug')('jwks');\nconst {\n  retrieveSigningKeys\n} = require('./utils');\nconst {\n  request,\n  cacheSigningKey,\n  rateLimitSigningKey,\n  getKeysInterceptor,\n  callbackSupport\n} = require('./wrappers');\nconst JwksError = require('./errors/JwksError');\nconst SigningKeyNotFoundError = require('./errors/SigningKeyNotFoundError');\nclass JwksClient {\n  constructor(options) {\n    this.options = {\n      rateLimit: false,\n      cache: true,\n      timeout: 30000,\n      ...options\n    };\n\n    // Initialize wrappers.\n    if (this.options.getKeysInterceptor) {\n      this.getSigningKey = getKeysInterceptor(this, options);\n    }\n    if (this.options.rateLimit) {\n      this.getSigningKey = rateLimitSigningKey(this, options);\n    }\n    if (this.options.cache) {\n      this.getSigningKey = cacheSigningKey(this, options);\n    }\n    this.getSigningKey = callbackSupport(this, options);\n  }\n  async getKeys() {\n    logger(`Fetching keys from '${this.options.jwksUri}'`);\n    try {\n      const res = await request({\n        uri: this.options.jwksUri,\n        headers: this.options.requestHeaders,\n        agent: this.options.requestAgent,\n        timeout: this.options.timeout,\n        fetcher: this.options.fetcher\n      });\n      logger('Keys:', res.keys);\n      return res.keys;\n    } catch (err) {\n      const {\n        errorMsg\n      } = err;\n      logger('Failure:', errorMsg || err);\n      throw errorMsg ? new JwksError(errorMsg) : err;\n    }\n  }\n  async getSigningKeys() {\n    const keys = await this.getKeys();\n    if (!keys || !keys.length) {\n      throw new JwksError('The JWKS endpoint did not contain any keys');\n    }\n    const signingKeys = await retrieveSigningKeys(keys);\n    if (!signingKeys.length) {\n      throw new JwksError('The JWKS endpoint did not contain any signing keys');\n    }\n    logger('Signing Keys:', signingKeys);\n    return signingKeys;\n  }\n  async getSigningKey(kid) {\n    logger(`Fetching signing key for '${kid}'`);\n    const keys = await this.getSigningKeys();\n    const kidDefined = kid !== undefined && kid !== null;\n    if (!kidDefined && keys.length > 1) {\n      logger('No KID specified and JWKS endpoint returned more than 1 key');\n      throw new SigningKeyNotFoundError('No KID specified and JWKS endpoint returned more than 1 key');\n    }\n    const key = keys.find(k => !kidDefined || k.kid === kid);\n    if (key) {\n      return key;\n    } else {\n      logger(`Unable to find a signing key that matches '${kid}'`);\n      throw new SigningKeyNotFoundError(`Unable to find a signing key that matches '${kid}'`);\n    }\n  }\n}\nmodule.exports = {\n  JwksClient\n};","map":{"version":3,"names":["logger","require","retrieveSigningKeys","request","cacheSigningKey","rateLimitSigningKey","getKeysInterceptor","callbackSupport","JwksError","SigningKeyNotFoundError","JwksClient","constructor","options","rateLimit","cache","timeout","getSigningKey","getKeys","jwksUri","res","uri","headers","requestHeaders","agent","requestAgent","fetcher","keys","err","errorMsg","getSigningKeys","length","signingKeys","kid","kidDefined","undefined","key","find","k","module","exports"],"sources":["D:/Coding/React/taskmybusiness/node_modules/jwks-rsa/src/JwksClient.js"],"sourcesContent":["const logger = require('debug')('jwks');\nconst { retrieveSigningKeys } = require('./utils') ;\nconst { request, cacheSigningKey, rateLimitSigningKey, getKeysInterceptor, callbackSupport } = require('./wrappers');\nconst JwksError = require('./errors/JwksError');\nconst SigningKeyNotFoundError = require('./errors/SigningKeyNotFoundError');\n\nclass JwksClient {\n  constructor(options) {\n    this.options = {\n      rateLimit: false,\n      cache: true,\n      timeout: 30000,\n      ...options\n    };\n\n    // Initialize wrappers.\n    if (this.options.getKeysInterceptor) {\n      this.getSigningKey = getKeysInterceptor(this, options);\n    }\n\n    if (this.options.rateLimit) {\n      this.getSigningKey = rateLimitSigningKey(this, options);\n    }\n    if (this.options.cache) {\n      this.getSigningKey = cacheSigningKey(this, options);\n    }\n\n    this.getSigningKey = callbackSupport(this, options);\n  }\n\n  async getKeys() {\n    logger(`Fetching keys from '${this.options.jwksUri}'`);\n\n    try {\n      const res = await request({\n        uri: this.options.jwksUri,\n        headers: this.options.requestHeaders,\n        agent: this.options.requestAgent,\n        timeout: this.options.timeout,\n        fetcher: this.options.fetcher\n      });\n\n      logger('Keys:', res.keys);\n      return res.keys;\n    } catch (err) {\n      const { errorMsg } = err;\n      logger('Failure:', errorMsg || err);\n      throw (errorMsg ? new JwksError(errorMsg) : err);\n    }\n  }\n\n  async getSigningKeys() {\n    const keys = await this.getKeys();\n\n    if (!keys || !keys.length) {\n      throw new JwksError('The JWKS endpoint did not contain any keys');\n    }\n\n    const signingKeys = await retrieveSigningKeys(keys);\n\n    if (!signingKeys.length) {\n      throw new JwksError('The JWKS endpoint did not contain any signing keys');\n    }\n\n    logger('Signing Keys:', signingKeys);\n    return signingKeys;\n  }\n\n  async getSigningKey (kid) {\n    logger(`Fetching signing key for '${kid}'`);\n    const keys = await this.getSigningKeys();\n\n    const kidDefined = kid !== undefined && kid !== null;\n    if (!kidDefined && keys.length > 1) {\n      logger('No KID specified and JWKS endpoint returned more than 1 key');\n      throw new SigningKeyNotFoundError('No KID specified and JWKS endpoint returned more than 1 key');\n    }\n\n    const key = keys.find(k => !kidDefined || k.kid === kid);\n    if (key) {\n      return key;\n    } else {\n      logger(`Unable to find a signing key that matches '${kid}'`);\n      throw new SigningKeyNotFoundError(`Unable to find a signing key that matches '${kid}'`);\n    }\n  }\n}\n\nmodule.exports = {\n  JwksClient\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}