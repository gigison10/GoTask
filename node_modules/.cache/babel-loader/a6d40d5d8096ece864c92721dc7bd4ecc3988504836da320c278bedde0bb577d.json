{"ast":null,"code":"\"use strict\";\n\n/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.overrideHttpRules = exports.transcode = exports.isProto3OptionalField = exports.flattenObject = exports.match = exports.applyPattern = exports.encodeWithoutSlashes = exports.encodeWithSlashes = exports.buildQueryStringComponents = exports.deleteField = exports.deepCopyWithoutMatchedFields = exports.getField = void 0;\nconst util_1 = require(\"./util\");\nconst httpOptionName = '(google.api.http)';\nconst proto3OptionalName = 'proto3_optional';\n// List of methods as defined in google/api/http.proto (see HttpRule)\nconst supportedHttpMethods = ['get', 'post', 'put', 'patch', 'delete'];\nfunction getField(request, field) {\n  let allowObjects = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  const parts = field.split('.');\n  let value = request;\n  for (const part of parts) {\n    if (typeof value !== 'object') {\n      return undefined;\n    }\n    value = value[part];\n  }\n  if (!allowObjects && typeof value === 'object' && !Array.isArray(value) && value !== null) {\n    return undefined;\n  }\n  return value;\n}\nexports.getField = getField;\nfunction deepCopyWithoutMatchedFields(request, fieldsToSkip) {\n  let fullNamePrefix = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '';\n  if (typeof request !== 'object' || request === null) {\n    return request;\n  }\n  const copy = Object.assign({}, request);\n  for (const key in copy) {\n    if (fieldsToSkip.has(`${fullNamePrefix}${key}`)) {\n      delete copy[key];\n      continue;\n    }\n    const nextFullNamePrefix = `${fullNamePrefix}${key}.`;\n    if (Array.isArray(copy[key])) {\n      // a field of an array cannot be addressed as \"request.field\", so we omit the skipping logic for array descendants\n      copy[key] = copy[key].map(value => deepCopyWithoutMatchedFields(value, new Set()));\n    } else if (typeof copy[key] === 'object' && copy[key] !== null) {\n      copy[key] = deepCopyWithoutMatchedFields(copy[key], fieldsToSkip, nextFullNamePrefix);\n    }\n  }\n  return copy;\n}\nexports.deepCopyWithoutMatchedFields = deepCopyWithoutMatchedFields;\nfunction deleteField(request, field) {\n  const parts = field.split('.');\n  while (parts.length > 1) {\n    if (typeof request !== 'object') {\n      return;\n    }\n    const part = parts.shift();\n    request = request[part];\n  }\n  const part = parts.shift();\n  if (typeof request !== 'object') {\n    return;\n  }\n  delete request[part];\n}\nexports.deleteField = deleteField;\nfunction buildQueryStringComponents(request) {\n  let prefix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n  const resultList = [];\n  for (const key in request) {\n    if (Array.isArray(request[key])) {\n      for (const value of request[key]) {\n        resultList.push(`${prefix}${encodeWithoutSlashes(key)}=${encodeWithoutSlashes(value.toString())}`);\n      }\n    } else if (typeof request[key] === 'object' && request[key] !== null) {\n      resultList.push(...buildQueryStringComponents(request[key], `${key}.`));\n    } else {\n      resultList.push(`${prefix}${encodeWithoutSlashes(key)}=${encodeWithoutSlashes(request[key] === null ? 'null' : request[key].toString())}`);\n    }\n  }\n  return resultList;\n}\nexports.buildQueryStringComponents = buildQueryStringComponents;\nfunction encodeWithSlashes(str) {\n  return str.split('').map(c => c.match(/[-_.~0-9a-zA-Z]/) ? c : encodeURIComponent(c)).join('');\n}\nexports.encodeWithSlashes = encodeWithSlashes;\nfunction encodeWithoutSlashes(str) {\n  return str.split('').map(c => c.match(/[-_.~0-9a-zA-Z/]/) ? c : encodeURIComponent(c)).join('');\n}\nexports.encodeWithoutSlashes = encodeWithoutSlashes;\nfunction escapeRegExp(str) {\n  return str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\nfunction applyPattern(pattern, fieldValue) {\n  if (!pattern || pattern === '*') {\n    return encodeWithSlashes(fieldValue);\n  }\n  if (!pattern.includes('*') && pattern !== fieldValue) {\n    return undefined;\n  }\n  // since we're converting the pattern to a regex, make necessary precautions:\n  const regex = new RegExp('^' + escapeRegExp(pattern).replace(/\\\\\\*\\\\\\*/g, '(.+)').replace(/\\\\\\*/g, '([^/]+)') + '$');\n  if (!fieldValue.match(regex)) {\n    return undefined;\n  }\n  return encodeWithoutSlashes(fieldValue);\n}\nexports.applyPattern = applyPattern;\nfunction fieldToCamelCase(field) {\n  const parts = field.split('.');\n  return parts.map(part => (0, util_1.toCamelCase)(part)).join('.');\n}\nfunction match(request, pattern) {\n  let url = pattern;\n  const matchedFields = [];\n  for (;;) {\n    const match = url.match(/^(.*)\\{([^}=]+)(?:=([^}]*))?\\}(.*)/);\n    if (!match) {\n      break;\n    }\n    const [, before, field, pattern, after] = match;\n    const camelCasedField = fieldToCamelCase(field);\n    matchedFields.push(fieldToCamelCase(camelCasedField));\n    const fieldValue = getField(request, camelCasedField);\n    if (fieldValue === undefined) {\n      return undefined;\n    }\n    const appliedPattern = applyPattern(pattern, fieldValue === null ? 'null' : fieldValue.toString());\n    if (appliedPattern === undefined) {\n      return undefined;\n    }\n    url = before + appliedPattern + after;\n  }\n  return {\n    matchedFields,\n    url\n  };\n}\nexports.match = match;\nfunction flattenObject(request) {\n  const result = {};\n  for (const key in request) {\n    if (request[key] === undefined) {\n      continue;\n    }\n    if (Array.isArray(request[key])) {\n      // According to the http.proto comments, a repeated field may only\n      // contain primitive types, so no extra recursion here.\n      result[key] = request[key];\n      continue;\n    }\n    if (typeof request[key] === 'object' && request[key] !== null) {\n      const nested = flattenObject(request[key]);\n      for (const nestedKey in nested) {\n        result[`${key}.${nestedKey}`] = nested[nestedKey];\n      }\n      continue;\n    }\n    result[key] = request[key];\n  }\n  return result;\n}\nexports.flattenObject = flattenObject;\nfunction isProto3OptionalField(field) {\n  return field && field.options && field.options[proto3OptionalName];\n}\nexports.isProto3OptionalField = isProto3OptionalField;\nfunction transcode(request, parsedOptions) {\n  const httpRules = [];\n  for (const option of parsedOptions) {\n    if (!(httpOptionName in option)) {\n      continue;\n    }\n    const httpRule = option[httpOptionName];\n    httpRules.push(httpRule);\n    if (httpRule === null || httpRule === void 0 ? void 0 : httpRule.additional_bindings) {\n      const additionalBindings = Array.isArray(httpRule.additional_bindings) ? httpRule.additional_bindings : [httpRule.additional_bindings];\n      httpRules.push(...additionalBindings);\n    }\n  }\n  for (const httpRule of httpRules) {\n    for (const httpMethod of supportedHttpMethods) {\n      if (!(httpMethod in httpRule)) {\n        continue;\n      }\n      const pathTemplate = httpRule[httpMethod];\n      const matchResult = match(request, pathTemplate);\n      if (matchResult === undefined) {\n        continue;\n      }\n      const {\n        url,\n        matchedFields\n      } = matchResult;\n      let data = deepCopyWithoutMatchedFields(request, new Set(matchedFields));\n      if (httpRule.body === '*') {\n        return {\n          httpMethod,\n          url,\n          queryString: '',\n          data\n        };\n      }\n      // one field possibly goes to request data, others go to query string\n      const queryStringObject = data;\n      if (httpRule.body) {\n        data = getField(queryStringObject, fieldToCamelCase(httpRule.body), /*allowObjects:*/true);\n        deleteField(queryStringObject, fieldToCamelCase(httpRule.body));\n      } else {\n        data = '';\n      }\n      const queryStringComponents = buildQueryStringComponents(queryStringObject);\n      const queryString = queryStringComponents.join('&');\n      if (!data || typeof data === 'object' && Object.keys(data).length === 0) {\n        data = '';\n      }\n      return {\n        httpMethod,\n        url,\n        queryString,\n        data\n      };\n    }\n  }\n  return undefined;\n}\nexports.transcode = transcode;\n// Override the protobuf json's the http rules.\nfunction overrideHttpRules(httpRules, protoJson) {\n  for (const rule of httpRules) {\n    if (!rule.selector) {\n      continue;\n    }\n    const rpc = protoJson.lookup(rule.selector);\n    // Not support override on non-exist RPC or a RPC without an annotation.\n    // We could reconsider if we have the use case later.\n    if (!rpc || !rpc.parsedOptions) {\n      continue;\n    }\n    for (const item of rpc.parsedOptions) {\n      if (!(httpOptionName in item)) {\n        continue;\n      }\n      const httpOptions = item[httpOptionName];\n      for (const httpMethod in httpOptions) {\n        if (httpMethod in rule) {\n          if (httpMethod === 'additional_bindings') {\n            continue;\n          }\n          httpOptions[httpMethod] = rule[httpMethod];\n        }\n        if (rule.additional_bindings) {\n          httpOptions['additional_bindings'] = !httpOptions['additional_bindings'] ? [] : Array.isArray(httpOptions['additional_bindings']) ? httpOptions['additional_bindings'] : [httpOptions['additional_bindings']];\n          // Make the additional_binding to be an array if it is not.\n          httpOptions['additional_bindings'].push(...rule.additional_bindings);\n        }\n      }\n    }\n  }\n}\nexports.overrideHttpRules = overrideHttpRules;","map":{"version":3,"names":["util_1","require","httpOptionName","proto3OptionalName","supportedHttpMethods","getField","request","field","allowObjects","arguments","length","undefined","parts","split","value","part","Array","isArray","exports","deepCopyWithoutMatchedFields","fieldsToSkip","fullNamePrefix","copy","Object","assign","key","has","nextFullNamePrefix","map","Set","deleteField","shift","buildQueryStringComponents","prefix","resultList","push","encodeWithoutSlashes","toString","encodeWithSlashes","str","c","match","encodeURIComponent","join","escapeRegExp","replace","applyPattern","pattern","fieldValue","includes","regex","RegExp","fieldToCamelCase","toCamelCase","url","matchedFields","before","after","camelCasedField","appliedPattern","flattenObject","result","nested","nestedKey","isProto3OptionalField","options","transcode","parsedOptions","httpRules","option","httpRule","additional_bindings","additionalBindings","httpMethod","pathTemplate","matchResult","data","body","queryString","queryStringObject","queryStringComponents","keys","overrideHttpRules","protoJson","rule","selector","rpc","lookup","item","httpOptions"],"sources":["../../src/transcoding.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}